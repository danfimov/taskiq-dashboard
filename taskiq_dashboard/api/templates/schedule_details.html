<!doctype html>
<html lang="en">
    <head>
        <title>Schedule Details</title>
        <meta name="description" content="Schedule details in Taskiq Dashboard" />
        <meta name="keywords" content="python, taskiq, schedule" />
        {% include "partial/head.html" %}
        <script defer>
            {% include "scripts/copy-button.js" %}
        </script>
    </head>
    <body class="bg-ctp-base text-ctp-text">
        {% include "partial/header.html" %}
        <main class="container mx-auto px-4 py-8" x-data="{ editing: false }">
            <form
                hx-post="{{ url_for('Edit schedule', schedule_id=schedule.schedule_id) }}"
                hx-target="#notification-list"
                hx-swap="beforeend"
            >
                <section class="p-6 mb-6 bg-ctp-lavender/10 rounded-xl">
                    <div class="flex justify-between items-start mb-4">
                        <div class="mb-4 pb-4">
                            <h1 class="font-bold text-xl">General Information</h1>
                            <p class="font-light">Description and general information about the schedule</p>
                        </div>
                        <div class="flex items-center gap-2 text-ctp-base">
                            <button
                                type="button"
                                x-show="!editing"
                                @click="editing = true"
                                class="px-3 py-1.5 bg-ctp-blue rounded cursor-pointer hover:bg-ctp-blue-600 transition focus:outline-2 focus:outline-offset-2 focus:outline-ctp-blue-500 active:bg-ctp-blue-700"
                            >
                                Edit
                            </button>
                            <button
                                type="button"
                                x-show="!editing"
                                hx-delete="{{ url_for('Delete schedule', schedule_id=schedule.schedule_id) }}"
                                class="px-3 py-1.5 bg-ctp-red rounded cursor-pointer hover:bg-ctp-red-600 transition focus:outline-2 focus:outline-offset-2 focus:outline-ctp-red-500 active:bg-ctp-red-700 text-ctp-base"
                            >
                                Delete
                            </button>
                            <button
                                type="submit"
                                x-show="editing"
                                x-cloak
                                class="px-3 py-1.5 bg-ctp-blue rounded cursor-pointer hover:bg-ctp-blue-600 transition focus:outline-2 focus:outline-offset-2 focus:outline-ctp-blue-500 active:bg-ctp-blue-700"
                            >
                                Save
                            </button>
                            <button
                                type="button"
                                x-show="editing"
                                x-cloak
                                @click="editing = false"
                                class="px-3 py-1.5 bg-ctp-surface2 rounded cursor-pointer hover:bg-ctp-surface1 transition focus:outline-2 focus:outline-offset-2 focus:outline-ctp-surface2 active:bg-ctp-base text-ctp-text"
                            >
                                Cancel
                            </button>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div>
                            <h3 class="mb-2">Source</h3>
                            <span
                                class="px-2 py-1 inline-flex text-sm leading-5 rounded text-ctp-base bg-linear-to-br {% if schedule.source_id % 10 == 0 %} from-ctp-teal to-ctp-teal-600 {% elif schedule.source_id % 10 == 1 %}from-ctp-green to-ctp-green-600 {% elif schedule.source_id % 10 == 2 %}from-ctp-red to-ctp-red-600 {% elif schedule.source_id % 10 == 3 %}from-ctp-blue to-ctp-blue-600 {% elif schedule.source_id % 10 == 4 %}from-ctp-maroon to-ctp-maroon-600 {% elif schedule.source_id % 10 == 5 %}from-ctp-sky to-ctp-sky-600 {% elif schedule.source_id % 10 == 6 %}from-ctp-sapphire to-ctp-sapphire-600 {% elif schedule.source_id % 10 == 7 %}from-ctp-flamingo to-ctp-flamingo-600 {% elif schedule.source_id % 10 == 8 %}from-ctp-rosewater to-ctp-rosewater-600 {% elif schedule.source_id % 10 == 9 %}from-ctp-mauve to-ctp-mauve-600{% endif %}"
                            >
                                {{ schedule.source }}
                            </span>
                        </div>
                        <div>
                            <h3 class="mb-2">Task name</h3>
                            <p class="font-light">{{ schedule.task_name }}</p>
                        </div>
                        <div>
                            <h3 class="mb-2">Cron</h3>
                            <p class="font-light" x-show="!editing">{{ schedule.cron }}</p>
                            <input
                                x-show="editing"
                                x-cloak
                                type="text"
                                name="cron"
                                value="{{ schedule.cron or '' }}"
                                placeholder="e.g. */5 * * * *"
                                class="w-full px-3 py-1.5 bg-ctp-base border border-ctp-surface2 rounded text-ctp-text focus:outline-none focus:border-ctp-blue font-light"
                            />
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div>
                            <h3>Schedule ID</h3>
                            <span class="font-light">{{ schedule.schedule_id }}</span>
                            <div
                                x-data="copyButton('{{ schedule.schedule_id }}')"
                                @click="copy()"
                                class="ml-2 p-1 rounded hover:bg-ctp-blue/20 cursor-pointer inline-flex items-center text-ctp-text hover:text-primary transition-colors"
                            >
                                <svg x-show="!copied" class="h-4 w-4">
                                    <use href="{{ url_for('static', path='icons.svg#copy') }}"></use>
                                </svg>
                                <svg x-show="copied" class="h-4 w-4">
                                    <use href="{{ url_for('static', path='icons.svg#copy-check') }}"></use>
                                </svg>
                            </div>
                        </div>

                        <div>
                            <h3 class="mb-2">Time</h3>
                            <p x-show="!editing">
                                {{ schedule.time.strftime('%Y-%m-%d %H:%M:%S') if schedule.time else '-' }}
                            </p>
                            <input
                                x-show="editing"
                                x-cloak
                                type="datetime-local"
                                name="time"
                                value="{{ schedule.time.strftime('%Y-%m-%dT%H:%M') if schedule.time else '' }}"
                                class="w-full px-3 py-1.5 bg-ctp-base border border-ctp-surface2 rounded text-ctp-text focus:outline-none focus:border-ctp-blue font-light"
                            />
                        </div>
                        <div>
                            <h3 class="mb-2">Cron offset</h3>
                            <p x-show="!editing">{{ schedule.cron_offset }}</p>
                            <input
                                x-show="editing"
                                x-cloak
                                type="text"
                                name="cron_offset"
                                value="{{ schedule.cron_offset or '' }}"
                                placeholder="e.g. +05:30 or UTC"
                                class="w-full px-3 py-1.5 bg-ctp-base border border-ctp-surface2 rounded text-ctp-text focus:outline-none focus:border-ctp-blue font-light"
                            />
                        </div>
                    </div>
                </section>

                <!-- Schedule arguments section -->
                <section class="p-6 mb-6 bg-ctp-lavender/10 rounded-xl">
                    <div class="mb-4 pb-4">
                        <h2 class="font-bold text-xl">Scheduled task arguments</h2>
                        <p class="font-light">Information about positional and keyword arguments of scheduled task</p>
                    </div>

                    <div class="mb-4">
                        <h3 class="mb-2 font-normal">Positional arguments</h3>
                        <div x-show="!editing">
                            {% if schedule.args %}
                            <div class="bg-ctp-base rounded p-4 overflow-x-auto">
                                <pre class="whitespace-pre-wrap text-sm">{{ schedule.args | tojson(indent=2) }}</pre>
                            </div>
                            {% else %}
                            <p class="text-ctp-subtext0">No arguments provided</p>
                            {% endif %}
                        </div>
                        <textarea
                            x-show="editing"
                            x-cloak
                            name="args"
                            rows="4"
                            class="w-full px-3 py-2 bg-ctp-base border border-ctp-surface2 rounded text-ctp-text font-mono text-sm focus:outline-none focus:border-ctp-blue"
                        >
{{ schedule.args | tojson(indent=2) }}</textarea
                        >
                    </div>

                    <div class="mb-4">
                        <h3 class="mb-2 font-normal">Keyword arguments</h3>
                        <div x-show="!editing">
                            {% if schedule.kwargs %}
                            <div class="bg-ctp-base rounded p-4 overflow-x-auto">
                                <pre class="whitespace-pre-wrap text-sm">{{ schedule.kwargs | tojson(indent=2) }}</pre>
                            </div>
                            {% else %}
                            <p class="text-ctp-subtext0">No keyword arguments provided</p>
                            {% endif %}
                        </div>
                        <textarea
                            x-show="editing"
                            x-cloak
                            name="kwargs"
                            rows="4"
                            class="w-full px-3 py-2 bg-ctp-base border border-ctp-surface2 rounded text-ctp-text font-mono text-sm focus:outline-none focus:border-ctp-blue"
                        >
{{ schedule.kwargs | tojson(indent=2) }}</textarea
                        >
                    </div>

                    <div class="mb-4">
                        <h3 class="mb-2 font-normal">Labels</h3>
                        <div x-show="!editing">
                            {% if schedule.labels %}
                            <div class="bg-ctp-base rounded p-4 overflow-x-auto">
                                <pre class="whitespace-pre-wrap text-sm">{{ schedule.labels | tojson(indent=2) }}</pre>
                            </div>
                            {% else %}
                            <p class="text-ctp-subtext0">No labels provided</p>
                            {% endif %}
                        </div>
                        <textarea
                            x-show="editing"
                            x-cloak
                            name="labels"
                            rows="4"
                            class="w-full px-3 py-2 bg-ctp-base border border-ctp-surface2 rounded text-ctp-text font-mono text-sm focus:outline-none focus:border-ctp-blue"
                        >
{{ schedule.labels | tojson(indent=2) }}</textarea
                        >
                    </div>
                </section>
            </form>
        </main>

        <div id="notification-list" class="fixed bottom-6 right-6 flex flex-col gap-3 w-fit"></div>
    </body>
</html>
